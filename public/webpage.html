<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Paste App</title>

<style>
body {
  background: #0f172a;
  font-family: Arial, sans-serif;
  color: #e5e7eb;
}

.container {
  width: 680px;
  margin: 60px auto;
  background: #020617;
  padding: 32px;
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
}

/* NAV */
nav {
  display: flex;
  gap: 12px;
  margin-bottom: 28px;
}

nav button {
  padding: 8px 18px;
  background: #1e293b;
  color: #e5e7eb;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
}

nav button:hover {
  background: #334155;
}

/* PAGES */
.page {
  display: none;
}

.page.active {
  display: block;
}

/* FORM ELEMENTS */
label {
  display: block;
  margin: 16px 0 6px;
  font-size: 13px;
  color: #cbd5f5;
}

input,
textarea {
  width: 100%;
  padding: 12px;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #1e293b;
  border-radius: 8px;
  font-size: 14px;
}

textarea {
  min-height: 140px;
  resize: vertical;
}

textarea.medium {
  min-height: 160px;
}

input.small {
  text-align: center;
}

/* ROWS */
.row {
  display: flex;
  gap: 20px;
  margin-top: 20px;
  align-items: flex-end;
}

.field {
  flex: 1;
}

/* PRIMARY BUTTON */
button.primary {
  padding: 10px 22px;
  background: #2563eb;
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  font-size: 14px;
  height: 42px;
}

button.primary:hover {
  background: #1d4ed8;
}

/* URL BOX */
.url-box {
  display: flex;
  gap: 12px;
  margin-top: 12px;
  align-items: center;
}

.url-box input {
  height: 42px;
}

.url-box button {
  padding: 10px 18px;
  background: #16a34a;
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  font-size: 14px;
  height: 42px;
}

.url-box button:hover {
  background: #15803d;
}
</style>
</head>

<body>

<div class="container">

  <nav>
    <button onclick="showPage('create')">Create</button>
    <button onclick="showPage('view')">View</button>
  </nav>

  <!-- CREATE PAGE -->
  <div id="create" class="page active">
    <h2>Create Paste</h2>

    <label>Paste Content</label>
    <textarea id="pasteContent"></textarea>

    <div class="row">
      <div class="field">
        <label>TTL (seconds)</label>
        <input type="number" id="ttl" />
      </div>

      <div class="field">
        <label>Max Views</label>
        <input type="number" id="maxViews" />
      </div>
    </div>

    <button class="primary" onclick="createPaste()">Submit</button>

    <label>Paste URL</label>
    <div class="url-box">
      <input id="pasteUrl" readonly />
      <button onclick="copyUrl()">Copy</button>
    </div>
  </div>

  <!-- VIEW PAGE -->
  <div id="view" class="page">
    <h2>View Paste</h2>

    <div class="row">
      <div class="field">
        <label>Paste ID</label>
        <input id="pasteId" />
      </div>
      <button class="primary" onclick="fetchPaste()">Fetch</button>
    </div>

    <label>Paste Content</label>
    <textarea id="viewContent" class="medium" readonly></textarea>

    <div class="row">
      <div class="field">
        <label>Views</label>
        <input class="small" id="viewViews" readonly />
      </div>

      <div class="field">
        <label>Expires In</label>
        <input class="small" id="viewExpiry" readonly />
      </div>
    </div>
  </div>

</div>

<script>
function showPage(id) {
  document.querySelectorAll(".page").forEach(p =>
    p.classList.remove("active")
  );
  document.getElementById(id).classList.add("active");
}

async function createPaste() {
  const payload = {
    pasteContent: document.getElementById("pasteContent").value,
    ttl_seconds: document.getElementById("ttl").value,
    max_views: document.getElementById("maxViews").value
  };

  try {
    const response = await fetch("https://aganitha-test-repo.vercel.app/api/pastes", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await response.json();

    if (!response.ok) {
      alert(data.error || "Failed to create paste");
      return;
    }

    document.getElementById("pasteUrl").value = data.url;
  } catch (err) {
    alert("API Error: " + err.message);
  }
}

async function fetchPaste() {
  const pasteId = document.getElementById("pasteId").value;

  try {
    const response = await fetch(`https://aganitha-test-repo.vercel.app/api/pastes/${pasteId}`);
    const data = await response.json();

    if (!response.ok) {
      alert(data.error || "Paste not found");
      return;
    }

    document.getElementById("viewContent").value = data.pasteContent || "";
    document.getElementById("viewViews").value = data.remaining_views ?? "0";
    document.getElementById("viewExpiry").value = data.expires_at ?? "--";
  } catch (err) {
    alert("Fetch Error: " + err.message);
  }
}

function copyUrl() {
  const input = document.getElementById("pasteUrl");
  input.select();
  document.execCommand("copy");
}
</script>

</body>
</html>
